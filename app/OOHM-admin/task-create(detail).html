<!DOCTYPE html>
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--><html lang="en"> <!--<![endif]-->
<head>
    <meta charset="utf-8"/>
    <title>index</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" />
    <link href="assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href="assets/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <link href="css/style.css" rel="stylesheet" />
    <link href="css/style-responsive.css" rel="stylesheet" />
    <link href="css/style-default.css" rel="stylesheet" id="style_color" />
    <link href="css/page.css" rel="stylesheet" type="text/css"/>
</head>

<body class="fixed-top">


    <!-- begin header -->
    <div id="header" class="navbar navbar-inverse navbar-fixed-top">
       <div class="navbar-inner">
           <div class="container-fluid">



               <!--sidebar toggle-->
               <div class="sidebar-toggle-box hidden-phone">
                   <div class="icon-reorder tooltips" data-placement="right" data-original-title="Toggle Navigation"></div>
               </div>


               <!-- LOGO -->
               <a class="brand" href="index.html">
                   <h1>LOGO</h1>
               </a>

               <a class="btn btn-navbar collapsed" id="main_menu_trigger" data-toggle="collapse" data-target=".nav-collapse">
                   <span class="icon-bar"></span>
                   <span class="icon-bar"></span>
                   <span class="icon-bar"></span>
                   <span class="arrow"></span>
               </a>


               <!-- user avatar -->
               <div class="top-nav">
                   <ul class="nav pull-right top-menu" >

                       <li class="dropdown">
                           <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                              <span class="username">Jhon Doe</span>
                              <b class="caret"></b>
                              <img src="img/avatar1_small.jpg" class="logined" alt="">
                           </a>
                           <ul class="dropdown-menu extended logout">
                              <li>
                                  <a href="personal-center.html"><i class="icon-key"></i>个人中心</a>
                              </li>
                              <li>
                                  <a href="login.html"><i class="icon-key"></i>退出</a>
                              </li>
                           </ul>
                       </li>
                       <li>
                            <a href="#">
                               <img src="img/avatar.png" class="login-before" alt="">
                            </a>
                       </li>
                   </ul>
               </div>


           </div>
       </div>
    </div>
    <!-- end header -->




  <!-- BEGIN CONTAINER -->
  <div id="container" class="row-fluid">



      <!-- begin slidebar -->
      <div class="sidebar-scroll">
          <div id="sidebar" class="nav-collapse collapse">

            <ul class="sidebar-menu">

                <li class="sub-menu active">
                    <a class="" href="index.html">
                        <i class="icon-dashboard"></i>
                        <span>活动列表</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a class="" href="monitor-people.html">
                        <i class="icon-dashboard"></i>
                        <span>监测人列表</span>
                    </a>
                </li>

                <li class="sub-menu">
                    <a class="" href="pw-change.html">
                        <i class="icon-dashboard"></i>
                        <span>密码修改</span>
                    </a>
                </li>

                
            </ul>

        </div>
      </div>
      <!-- end slidebar -->






      <!-- begin 中间内容区-->  
      <div id="main-content" class="container-fluid task-create-detail">
        
          <h3 class="page-title">创建任务/任务详情</h3>


          <div class="widget-body form">
                
              <!-- BEGIN FORM-->
              <form class="form-horizontal" action="javascript:;">
                    
                    <div class="control-group">
                        <label class="control-label">活动名称：</label>
                        <div class="controls-value">活动1</div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">广告主：</label>
                        <div class="controls-value">耐克专卖店</div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">品牌：</label>
                        <div class="controls-value">耐克</div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">任务名称：</label>
                        <div class="controls">
                            <input type="text" class="span6 tcd-vl-text" id="taskName" placeholder="任务名称" />
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">广告牌数量：</label>
                        <div class="controls-value">
                            <input type="text" class="span6 tcd-vl-text" id="taskBrandNum" placeholder="广告牌数量">
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">地点：</label>
                        <div class="controls-value">
                            <input type="text" class="span6 tcd-vl-text" id="taskAddress" placeholder="地点">
                        </div>
                    </div>
    
                    <div class="control-group">
                        <label class="control-label">监测人：</label>
                        <div class="controls-value">
                            <input type="text" class="span6 tcd-vl-text" id="changeMonitor" placeholder="监测人">
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">形式：</label>
                        <div class="controls-value at-type-w">
                            <input type="checkbox" class="checkboxes" id="tcd-photo" />
                            <label for="tcd-photo">拍照</label>
                            <input type="checkbox" class="checkboxes" id="tcd-video" />
                            <label for="tcd-video">视频</label>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">任务说明：</label>
                        <div class="controls-value">
                            <textarea class="span6 tcd-textarea"></textarea>
                        </div>
                    </div>
    
    
                    <div class="control-group">
                        <label>
                            <input type="checkbox" class="checkboxes" id="tcd-video" />引用活动阶段：
                            <button class="btn btn-small btn-warning" id="TCDaddStage">添加</button>
                        </label>
                    </div>
    
                    
                    <div class="control-group">
                        <div class="tcd-stage">
                            <table class="table table-bordered tcd-table">
                                <thead>
                                  <tr>
                                      <th width="14%">阶段名称</th>
                                      <th width="30%">时间范围</th>
                                      <th width="8%">计划数量</th>
                                      <th width="7%">已上传数量</th>
                                      <th width="7%">已审核数量</th>
                                      <th width="13%">状态</th>
                                      <th width="19%">操作</th>
                                  </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td><input type="text" value="活动1" /></td>
                                        <td class="tcd-time-range"><input type="text" id="tcdDate00" class="tcd-start" value="2017-01-01" /> - <input type="text"  id="tcdDate01" class="tcd-end" value="2017-01-05" /></td>
                                        <td><input type="text" value="5" /></td>
                                        <td>2</td>
                                        <td>1</td>
                                        <td>
                                            <select class="input-medium m-wrap" tabindex="1">
                                                <option value="进行中">进行中</option>
                                                <option value="已完成">已完成</option>
                                                <option value="未生效">未生效</option>
                                            </select></th>
                                        </td>
                                        <td>
                                            <button class="btn btn-small btn-danger at-delete" type="button">删除</button>
                                            <button class="btn btn-small btn-primary look-picture">查看图片</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>



                    <button class="btn btn-primary btn-success" id="tcdSave">保存</button>



              </form>
              <!-- end FORM-->

          </div>


      </div>
      <!-- end  中间内容区-->  



  </div>
  <!-- END CONTAINER -->





  <div id="footer">
     ©2017 20170331170544
  </div>




<script src="js/jquery-1.8.3.min.js"></script>
<script type="text/javascript" src="assets/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<script src="assets/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="assets/uniform/jquery.uniform.min.js"></script>
<script type="text/javascript" src="js/layer/layer.js"></script>
<script type="text/javascript" src="js/laydate/laydate.js"></script>
<script type="text/javascript" src="js/laypage/laypage.js"></script>
<script src="js/jquery.scrollto.min.js"></script>
<!--common script for all pages-->
<script src="js/common-scripts.js"></script>



<script>

  $(function () {
      $("input[type=checkbox]").uniform();
  });

  $('.tcd-table tbody tr').each(function() {
      addNewDate($(this));
  })

  function addNewDate(objArg) {
      var atDateStart = objArg.find('.tcd-start').eq(0);
      var atDateStartID = objArg.find('.tcd-start').eq(0).prop('id');

      var atDateEnd = objArg.find('.tcd-end').eq(0);
      var atDateEndID = objArg.find('.tcd-end').eq(0).prop('id');

      var dateStartDate = {
         elem: '#' + atDateStartID,
         istoday: false, //是否显示今天
         choose: function(datas){
          dateEndDate.min = datas //将结束日的初始值设定为开始日
         }
      };
      var dateEndDate = {
         elem: '#' + atDateEndID,
         choose: function(datas){
            dateStartDate.max = datas; //结束日选好后，重置开始日的最大日期
         }
      }
      atDateStart.focus(function() {
        laydate(dateStartDate);
      })
      atDateEnd.focus(function() {
        laydate(dateEndDate);
      })
   }


   // 图片查看
   var newTastBool = true;
   $('.tcd-table').on('click', '.look-picture', function() {
      if(newTastBool) {
          layer.msg('现在没有图片可以查看！！');
      } else {

      }
   })

   // 删除活动阶段
   $('.tcd-table').on('click', '.at-delete', function() {
      var _this = $(this);
      var layerDel = layer.confirm('确定删除？', {
        btn: ['确定','取消'] //按钮
      }, function(){
        layer.close(layerDel);
        _this.parents('tr').remove();
        layer.msg('删除成功!');
      }, function(){
      });
   })



   // 添加活动阶段
    $('#TCDaddStage').click(function() {
        var validateReturn = atValidate();
        if(!validateReturn) {
            return;
        }

        var atTbody = $('.tcd-table tbody');
        var trCurLenght = atTbody.find('tr').length;
        var apHtml = '<tr><td><input type="text" placeholder="阶段名称" /></td><td class="tcd-time-range"><input type="text" id="tcdDate' + trCurLenght + '0" class="tcd-start" placeholder="开始日期" /> - <input type="text"  id="tcdDate' + trCurLenght + '1" class="tcd-end" placeholder="结束日期" /></td><td><input type="text" placeholder="计划数量" /></td><td>0</td><td>0</td><td><select class="input-medium m-wrap" tabindex="1"><option value="进行中">进行中</option><option value="已完成">已完成</option><option value="未生效">未生效</option></select></th></td><td><button class="btn btn-small btn-danger at-delete" type="button">删除</button><button class="btn btn-small btn-primary look-picture">查看图片</button></td></tr>';
        atTbody.append(apHtml);
        addNewDate(atTbody.find('tr').eq(trCurLenght));
        return false;
    })

    // 活动保存
    $('#tcdSave').click(function() {
        var validateReturn = atValidate();
        if(!validateReturn) {
            return;
        } else {
            layer.msg('保存成功！');
            layerClose();
        }
    })

   // 表单验证不为空 
   function atValidate() {
      var atValidateV = true;
      $('.tcd-vl-text').each(function() {
          if($(this).val() == '') {
             layer.msg($(this).parents('.control-group').find('.control-label').text().replace('：', '') + '不能为空！')
             $(this).focus();
             atValidateV = false;
             return false;
          }
      })
      if(!atValidateV) {
        return atValidateV;
      }

      if( $('.at-type-w').find('input[type=checkbox]:checked').length <= 0 ) {
         layer.msg('请选择活动形式！');
         atValidateV = false;
         return false;
      }
      if(!atValidateV) {
        return atValidateV;
      }


      $('.tcd-table tr').find('input[type=text]').each(function() {
          if($(this).val() == '') {
             layer.msg('活动阶段填写不完整！');
             $(this).focus();
             atValidateV = false;
             return false;
          }
      })

      return atValidateV;
      
   }



   // 监测人修改
   var atHtml = '<form class="OOHM-layer-form" action="#"><div class="monitor-tb-w">' + 

        '<table class="table table-bordered"><thead><tr><th width="30%"><input type="checkbox" class="group-checkable" id="monitorCheckbox" />全选</th><th>监测人</th><th>电话</th></tr></thead><tbody id="monitorTbody">' +


            '<tr><td><input type="checkbox" id="m0" class="monitor-cbox" /></td><td>张三</td><td>18825112987</td></tr>' + 
            '<tr><td><input type="checkbox" id="m1" class="monitor-cbox" /></td><td>李四</td><td>18825112987</td></tr>' + 
            '<tr><td><input type="checkbox" id="m2" class="monitor-cbox" /></td><td>王五</td><td>18825112987</td></tr>'


        + '</tbody></table></div>' +  
    

      '<div class="form-btn-w"><button class="btn" id="MonitorCancle" type="button">取消</button><button class="btn  btn-success" id="MonitorConfirm" type="button">确定</button></div>' +

      '<div class="invite-monitor"><h4>发送邀请链接</h4><div class="invite-content"><h5>邀请加入任务：<span id="taskSelectedList"></span></h5><p>复制以下链接和密码，通过QQ、邮箱、微信等方式发送给你的朋友。</p><div class="invite-info-w"><input type="text" class="invite-url" value="http://www.ados.cn/liuliangu/index/index.html。邀请密码：123456" /><button class="btn  btn-info" type="button">复制</button></div><p class="reset-invite-pw">重置邀请密码</p></div></div>'


    +'</form>';

   $('#changeMonitor').click(function() {
      var layerMask = layer.open({
        type: 1,
        title: '<div>请选择监测人</div>',
        skin: 'adminLogin', //加上边框
        area: ['640px', 'auto'], //宽高
        // scrollbar: false,
        content: atHtml
      });
      function layerClose(){layer.close(layerMask);}

      $(".OOHM-layer-form input[type=checkbox]").uniform();// checkbox样式重置
      XjQuery.selectAll('#monitorCheckbox', '.monitor-cbox');// 监测人修改全选
      

      // var oldMVal = $('#changeMonitor').val().split('、');//已选的监测人
      var oldMID = $('#changeMonitor').data('selectedID');
      var oldMIDLen = $('#changeMonitor').data('selectedLen');
      if(oldMID) {
        $.each(oldMID, function() {
            $('#' + this).prop('checked', true).parent().addClass('checked');
            if($('.monitor-cbox').length == oldMIDLen) {
              $('#monitorCheckbox').prop('checked', true).parent().addClass('checked');
            }
        })
      }
      $('#taskSelectedList').text($('#taskName').val());

      $('#MonitorCancle').click(function() {
          layerClose();
      });

      $('#MonitorConfirm').click(function() {
          var mTdcheckbox = $('#monitorTbody tr td:first-child input[type=checkbox]:checked');
          if(mTdcheckbox.length <= 0) {
            layer.msg('监测人不能为空！');
          } else {
            var selectedM = [];
            var selectedMID = [];
            $('.monitor-cbox:checked').each(function() {
                selectedM.push($(this).parents('td').next('td').text());
                selectedMID.push(this.id);
            })
            $('#changeMonitor').val(selectedM.join('、')).data('selectedID', selectedMID).data('selectedLen', selectedMID.length);
            layerClose();
          }
      })

   })
   

</script>
</body>
</html>
